before_install: ./bin/preinstall-travis-deploy-dependencies
bundler_args: --deployment --without development
cache:
  bundler: true
  directories:
    - $(rvm gemdir)
    - build
deploy:
  # Prod
  - provider: s3
    access_key_id: # chef-prod learn-chef IAM user
      secure: "RB+cF7bA8oI39kNa+pwF4fIkYbeTYddBqE3OEcxGwaKQ1JI6ej+yKEIyv7hB+825gbn/x+yuVMK5BigR3RsLDeCp+Q9Khv8aroC0ZXUdf/aM6Z9x6C7hORV7+/2qPwxvXDwCwbifeieSXz0dzRLOgzjp9WYgM5BWZmlUpZoV5Bo="
    secret_access_key:
      secure: "Elc66revkDU5zMv7i1bE/wXNfLmmhz/7rnnHo+uAI9I/UoXeRYCE5HTLD8OSHycniEpu/3j7YWeJFaUx+RCyoSIbSMW1lNSuHE7aZMeo8bI/xJxML+jDrR/NE1Iz/bXKhlKWbH9hXaorXaZ+VgY0Um30yRBRtKdDZ4KMcTCw30I="
    bucket: learn.getchef.com
    endpoint: learn.getchef.com.s3-website-us-east-1.amazonaws.com
    skip_cleanup: true
    local-dir: build
    env:
      - AWS_S3_BUCKET=learn.getchef.com
      - CLOUDFRONT_DISTRIBUTION_ID=E1WC83ND9PN8RY
      # AWS_ACCESS_KEY_ID
      - secure: "qyK6429tsY/vBk+sF/mkn0D2nB0R/v6IBWahQrKV7Iupiz85pMlsAzitBUGktIXlPATOWVP/I/A2SmZwcM+Vpu8mbOSd222FvZQAsHNHLUHHlz/Yq5Hd+dVsMie5LFlaLKAWwh61uZgGBFlutB4pu5KFNhfwlnaeIor7AjWw/d4="
      # AWS_SECRET_ACCESS_KEY
      - secure: "h9w/4nCltY+G/y4NlXSxfxb1PxqZq1XXgM+GJTKCdw2QbxUxf7k2EaxR1YUvi5AINx96Su5OFQVU/t9syvAJGi0aH/6FZajjpZ5hiX5BDT2kXnjBi5us9MXlEccmqJXqd86QRbq56tj1xppHczOaSQd8JJ4N535cOG+pQKXqfvU="
    on:
      branch: release
    after_deploy: bundle exec middleman invalidate
  # Preprod
  - provider: s3
    access_key_id: # chef-preprod learn-chef IAM user
      secure: "qKNaFrRrVJAxflH56cZhy4bsZ7Hm5IYql3++ko7LlPa5yMCbfBS+9A4McXEv+0axlT6ytzSUfEkl7KKZLY4VX4RjF/GM95HTA5gAc8Ko6unAyfv1K2pQDTYtoNR4XVSGtBcwNREkXlTY52e3PEM31pwa9n1yKOnDqaPG5s+e4wg="
    secret_access_key:
      secure: "C5tFJ82XCansErEWXlgdFAJbGi3Q8Yd08xSa+UtJlQ6JcnhJsWic9o90bvJJLzygm2oy2KpXAB1ma2ygOL02mZqvOqF1tznPwIG10StMsMGkj+C4sCoSMnMm5Hg1Rh0HL4t5OVGMVj3COeYisX1agWV+xo0mx8X1O2j4Db6Gy/U="
    bucket: learn-preprod.getchef.com
    skip_cleanup: true
    local-dir: build
    on:
      branch: master
    env:
      - AWS_S3_BUCKET=learn-preprod.getchef.com
      # AWS_ACCESS_KEY_ID
      - secure: "ttV4xy4aOjyu8ZR7G9YqT8JjsrSzXiw4guC+nb9sp3Wo8Trvj4BYo4nrJFG1Q9Jt4H45Nmx30/YVT87bdPRGq7iMGp93DWnpcTDokBcFQHTlM+V10XoxEdIYtpMD1dDf6fuuFWBhYLj4wRQ3oKSTihrzZMlUidPV3Qi/SFdfbuA="
      # AWS_SECRET_ACCESS_KEY
      - secure: "fDhR/+Jg9UJ36ZnBYgNVlf7EAdR0W0jGkt+2L68AbXmVdUT+8g3nHzrqY7EyPkDVforBwexAsO/pHCw05GmRmpw6/MT2aR10IwKm5+yn6UjhgX6TA+ns2Zd/KCQhcbszM1F7Rl5uDAlkZWRgo+eQNHET6FwDstO55DONXiGdDhM="
  # Sandbox
  - provider: s3
    access_key_id: # chef-preprod learn-chef IAM user
      secure: "qKNaFrRrVJAxflH56cZhy4bsZ7Hm5IYql3++ko7LlPa5yMCbfBS+9A4McXEv+0axlT6ytzSUfEkl7KKZLY4VX4RjF/GM95HTA5gAc8Ko6unAyfv1K2pQDTYtoNR4XVSGtBcwNREkXlTY52e3PEM31pwa9n1yKOnDqaPG5s+e4wg="
    secret_access_key:
      secure: "C5tFJ82XCansErEWXlgdFAJbGi3Q8Yd08xSa+UtJlQ6JcnhJsWic9o90bvJJLzygm2oy2KpXAB1ma2ygOL02mZqvOqF1tznPwIG10StMsMGkj+C4sCoSMnMm5Hg1Rh0HL4t5OVGMVj3COeYisX1agWV+xo0mx8X1O2j4Db6Gy/U="
    bucket: learn-sandbox.getchef.com
    skip_cleanup: true
    local-dir: build
    on:
      branch: sandbox
    env:
      - AWS_S3_BUCKET=learn-sandbox.getchef.com
      # AWS_ACCESS_KEY_ID
      - secure: "ttV4xy4aOjyu8ZR7G9YqT8JjsrSzXiw4guC+nb9sp3Wo8Trvj4BYo4nrJFG1Q9Jt4H45Nmx30/YVT87bdPRGq7iMGp93DWnpcTDokBcFQHTlM+V10XoxEdIYtpMD1dDf6fuuFWBhYLj4wRQ3oKSTihrzZMlUidPV3Qi/SFdfbuA="
      # AWS_SECRET_ACCESS_KEY
      - secure: "fDhR/+Jg9UJ36ZnBYgNVlf7EAdR0W0jGkt+2L68AbXmVdUT+8g3nHzrqY7EyPkDVforBwexAsO/pHCw05GmRmpw6/MT2aR10IwKm5+yn6UjhgX6TA+ns2Zd/KCQhcbszM1F7Rl5uDAlkZWRgo+eQNHET6FwDstO55DONXiGdDhM="
script: bundle exec middleman build --verbose
