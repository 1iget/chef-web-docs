[HEADLINE] A _cookbook_ provides structure to your recipes and enables you to more easily reference external files, such as our web server's home page. In essence, a cookbook helps you stay organized.

Last time, you learned how to manage a package and a service by configuring a web server. You also added a basic web page. But there was one problem &ndash; although it helped you verify that your web server was properly configured, the code for your HTML page was embedded in the Chef recipe.

Let's create a _cookbook_ to make our web server recipe easier to manage.

[START_BOX]

## 1. Create a cookbook

First, from your <code class="file-path">~\chef-repo</code> directory, create a <code class="file-path">cookbooks</code> directory.

```ps
# ~\chef-repo
$ mkdir cookbooks
```

<% command_snippet(page: current_page, path: 'create-a-cookbook/mkdir-cookbooks') %>

Now run the `chef` command to generate a cookbook named `learn_chef_iis`.

```ps
# ~\chef-repo\cookbooks
$ chef generate cookbook learn_chef_iis
Compiling Cookbooks...
Recipe: code_generator::cookbook
  * directory[C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis] action create
    - create new directory C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis
  * template[C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis/metadata.rb] action create_if_missing
    - create new file C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis/metadata.rb
    - update content in file C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis/metadata.rb from none
    (diff output suppressed by config)
[...]
  * template[C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis/recipes/default.rb] action create_if_missing
    - create new file C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis/recipes/default.rb
    - update content in file C:/Users/Administrator/chef-repo/cookbooks/learn_chef_iis/recipes/default.rb from none to 0
8b977
    (diff output suppressed by config)
```

<% command_snippet(page: current_page, path: 'create-a-cookbook/chef-generate-cookbook') %>

The <% fp 'cookbooks/learn_chef_iis' %> part tells Chef to create a cookbook named `learn_chef_iis` under the <% fp 'cookbooks' %> directory.

Here's the directory structure that the command created.

```ps
# ~\chef-repo\cookbooks
$ tree /F
Folder PATH listing
Volume serial number is 0000000F 1697:4767
C:.
└───learn_chef_iis
    │   .kitchen.yml
    │   Berksfile
    │   chefignore
    │   metadata.rb
    │   README.md
    │
    ├───recipes
    │       default.rb
    │
    ├───spec
    │   │   spec_helper.rb
    │   │
    │   └───unit
    │       └───recipes
    │               default_spec.rb
    │
    └───test
        └───integration
            ├───default
            │   └───serverspec
            │           default_spec.rb
            │
            └───helpers
                └───serverspec
                        spec_helper.rb
```

<% command_snippet(page: current_page, path: 'create-a-cookbook/tree-cookbook') %>

Note the default recipe, named <code class="file-path">default.rb</code>. This is where we'll move our IIS recipe in a moment.

[END_BOX]

[START_BOX]

## 2. Create a template

Now we'll move the home page to an external file. First, run this command to generate the HTML file for our home page.

```ps
# ~\chef-repo\cookbooks
$ chef generate template learn_chef_iis Default.htm
Compiling Cookbooks...
Recipe: code_generator::template
  * directory[./learn_chef_iis/templates/default] action create
    - create new directory ./learn_chef_iis/templates/default
  * template[./learn_chef_iis/templates/default/Default.htm.erb] action create
    - create new file ./learn_chef_iis/templates/default/Default.htm.erb
    - update content in file ./learn_chef_iis/templates/default/Default.htm.erb from none to e3b0c4
    (diff output suppressed by config)
```

<% command_snippet(page: current_page, path: 'create-a-template/chef-generate-template') %>

The file <code class="file-path">Default.htm.erb</code> gets created under <code class="file-path">learn\_chef\_iis\templates\default</code>.

```ps
# ~\chef-repo\cookbooks
$ tree /F
Folder PATH listing
Volume serial number is 00000032 1697:4767
C:.
└───learn_chef_iis
    │   .kitchen.yml
    │   Berksfile
    │   chefignore
    │   metadata.rb
    │   README.md
    │
    ├───recipes
    │       default.rb
    │
    ├───spec
    │   │   spec_helper.rb
    │   │
    │   └───unit
    │       └───recipes
    │               default_spec.rb
    │
    ├───templates
    │   └───default
    │           Default.htm.erb
    │
    └───test
        └───integration
            ├───default
            │   └───serverspec
            │           default_spec.rb
            │
            └───helpers
                └───serverspec
                        spec_helper.rb
```

<% command_snippet(page: current_page, path: 'create-a-template/tree-template') %>

The .erb extension simply means that the file can have placeholders. More on that later.

Now copy the contents of the HTML file from your recipe to the new HTML file, <code class="file-path">Default.htm.erb</code>.

```html-Win32
<!-- ~\chef-repo\cookbooks\learn_chef_iis\templates\default\Default.htm.erb -->
<html>
  <body>
    <h1>hello world</h1>
  </body>
</html>
```

<% code_snippet(page: current_page, path: 'create-a-template/index-1') %>

[COMMENT] Here, you're adding the web site content directly to your cookbook for learning purposes. In practice, your web site content would more likely be some build artifact, for example a .zip file on your build server. With Chef, you could pull updated web content from your build server and deploy it to your web server.

[END_BOX]

[START_BOX]

## 3. Update the recipe to reference the HTML template

Write out the recipe, <code class="file-path">default.rb</code>, like this.

```ruby-Win32
# ~\chef-repo\cookbooks\learn_chef_iis\recipes\default.rb
powershell_script 'Install IIS' do
  code 'Add-WindowsFeature Web-Server'
  guard_interpreter :powershell_script
  not_if "(Get-WindowsFeature -Name Web-Server).Installed"
end

service 'w3svc' do
  action [:enable, :start]
end

template 'c:\inetpub\wwwroot\Default.htm' do
  source 'Default.htm.erb'
end
```

<% code_snippet(page: current_page, path: 'update-the-recipe-to-reference-the-html-template/default-1') %>

[END_BOX]

[START_BOX]

## 4. Run the cookbook

Now run the cookbook. To do so, we use the `chef-client` command and specify what's called the _run-list_.

```ps
# ~\chef-repo
$ chef-client --local-mode --runlist 'recipe[learn_chef_iis]'
[2016-01-07T14:03:32-08:00] WARN: No config file found or specified on command line, using command line options.
Starting Chef Client, version 12.6.0
resolving cookbooks for run list: ["learn_chef_iis"]
Synchronizing Cookbooks:
  - learn_chef_iis (0.1.0)
Compiling Cookbooks...
Converging 3 resources
Recipe: learn_chef_iis::default
  * powershell_script[Install IIS] action run (skipped due to not_if)
  * windows_service[w3svc] action enable
    - enable service windows_service[w3svc]
  * windows_service[w3svc] action start
    - start service windows_service[w3svc]
  * template[c:\inetpub\wwwroot\Default.htm] action create
    - update content in file c:\inetpub\wwwroot\Default.htm from 2914aa to 100c2f
    (no diff)

Running handlers:
Running handlers complete
Chef Client finished, 1/4 resources updated in 39 seconds
```

<% command_snippet(page: current_page, path: 'run-the-cookbook/cookbook-ccr-1') %>

Previously, you ran `chef-client` to run a single recipe from the command line. A run-list specifies each of the individual recipes from your cookbook that you want to apply. Here, you applied just one recipe, but the run-list can contain multiple recipes from multiple cookbooks.<br><br>In this example, `recipe[learn_chef_iis]` is the same as specifying `recipe[learn_chef_iis::default]`, meaning we want to run the `learn_chef_iis` cookbook's default recipe, <code class="file-path">default.rb</code>.

Run `Invoke-WebRequest` or refresh your web browser to confirm that your web page is still available.

```ps
# ~\chef-repo
$ (Invoke-WebRequest localhost).Content
<html>
  <body>
    <h1>hello world</h1>
  </body>
</html>
```

<% command_snippet(page: current_page, path: 'run-the-cookbook/cookbook-iwr-localhost') %>

The result is the same as before, but with a cookbook things are now easier to manage.

[END_BOX]
