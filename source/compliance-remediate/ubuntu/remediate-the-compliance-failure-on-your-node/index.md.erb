---
title: 'Remediate the compliance failure on your node'
order: 3
keywords: TODO
layout: lesson
sections: [exercises]
next: {heading: Conclusion, partial: conclusion}
time_to_complete: 30 minutes
---
In this part, you'll apply the firewall configuration to your Ubuntu node and then rerun the compliance scan to verify the fix.

To apply the firewall configuration, you'll upload the `ufw` cookbook to your Chef server and then bootstrap your Ubuntu node.

Recall that during the bootstrap process, a node installs `chef-client` and performs the initial check-in to the Chef server. When you bootstrap a node, you specify the _run-list_, which includes the recipes that you want to apply. `chef-client` fetches the latest cookbooks from the Chef server. To update your node's configuration, you upload a new version of your cookbook to the Chef server and run `chef-client` on your node.

Here's what you'll do in this part:

1. [Upload the ufw cookbook to your Chef server](#step1)
1. [Bootstrap your node](#step2)
1. [Rerun the compliance scan](#step3)

[START_BOX]

## 1. Upload the ufw     cookbook to your Chef server

The first step is to upload the `ufw` cookbook to the Chef server. This allows the node to fetch the cookbook during the bootstrap process.

Run this comand from your <% fp '~/learn-chef' %> directory.

```bash
# ~/learn-chef
$ knife cookbook upload ufw
Uploading ufw            [0.1.0]
Uploaded 1 cookbook.
```

[END_BOX]

[START_BOX]

## 2. Bootstrap your node

Next, bootstrap your Ubuntu 14.04 node. In the _Manage a node_ tutorial, you chose whether to bootstrap [using a password or key-based authentication](/manage-a-node/ubuntu/bootstrap-your-node#step1). Here, you'll use the second apprach with the SSH private key that you created in the previous tutorial.

Run this `knife bootstrap` command. Replace the IP address and the values of `--ssh-user` and `--identify-file` as needed.

```bash
# ~/learn-chef
$ knife bootstrap 192.168.145.134 --ssh-user vagrant --sudo --identity-file ~/.ssh/node1 --node-name node1 --run-list 'recipe[ufw]'
Creating new client for node1
Creating new node for node1
Connecting to 192.168.145.134
192.168.145.134 -----> Installing Chef Omnibus (-v 12)
[...]
192.168.145.134 Starting the first Chef Client run...
192.168.145.134 Starting Chef Client, version 12.9.41
192.168.145.134 resolving cookbooks for run list: ["ufw"]
192.168.145.134 Synchronizing Cookbooks:
192.168.145.134   - ufw (0.1.0)
192.168.145.134 Installing Cookbook Gems:
192.168.145.134 Compiling Cookbooks...
192.168.145.134 Converging 2 resources
192.168.145.134 Recipe: ufw::default
192.168.145.134   * execute[Enable SSH access] action run
192.168.145.134     - execute ufw allow ssh
192.168.145.134   * execute[Enable UFW] action run
192.168.145.134     - execute ufw --force enable
192.168.145.134
192.168.145.134 Running handlers:
192.168.145.134 Running handlers complete
192.168.145.134 Chef Client finished, 2/2 resources updated in 05 seconds
```

`chef-client` runs during the bootstrap process. You see from the output that `ufw` is enabled and allows SSH access.

[END_BOX]

[START_BOX]

## 3. Rerun the compliance scan

You've applied the updated SSH configuration to your node. Now let's scan your node against the CIS Benchmarks a second time to see whether the **Ensure Firewall is active** rule pases.

We expect the rule to pass because we verified the configuration on a test instance and saw the expected output when `chef-client` ran on the node.

From the dashboard in the web interface, select your node and click **Scan**.

![](compliance/scan_button_ubuntu1404.png)

Clear the checkbox for **Operating System Patch Level** and select **cis/cis-ubuntu14.04lts-level1**.

![](compliance/select_profiles_ubuntu1404a.png)
![](compliance/select_profiles_ubuntu1404b.png)

Click **Scan now** to start the scan.

![](compliance/scan_now_button.png)

Watch as your node is scanned. The scan may take a few minutes to complete.

![](compliance/scan_in_progress.png)

From the scan report, scroll to the **Ensure Firewall is active** rule. You see that the test passes.

![](compliance/firewall_ufw_compliant_ubuntu1404.png)

Congratulations. You're one step closer to meeting your compliance goals.

[END_BOX]

[START_BOX]

### How to clean up your environment

[Follow these steps](/manage-a-node/ubuntu/update-your-nodes-configuration#howtocleanupyourenvironment) from the _Manage a node_ tutorial if you want to clean up your Chef server after you complete this tutorial or you want to repeat the tutorial from the beginning.

To remove the `ufw` cookbook from your Chef server, run `knife cookbook delete ufw`.

```bash
# ~/learn-chef
$ knife cookbook delete ufw
Do you really want to delete ufw version 0.1.0? (Y/N) y
Deleted cookbook[ufw version 0.1.0]
```

To remove the node from your Chef Compliance server, select the node from the dashboard and click **Remove**.

![](compliance/remove_node_ubuntu1404.png)

[END_BOX]
