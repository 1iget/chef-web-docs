---
title: 'Add features to the web application'
order: 4
keywords: TODO
layout: lesson
sections: [exercises]
next: {heading: Next, partial: next}
time_to_complete: 60 minutes
meta_tags: [{name: 'robots', content: 'noindex, nofollow'}]
---
* Make the case for local development.
* Show the full diagram again if necessary.

* Show screenshot of where we started

* Show screenshot of where we're going

* In practice, you would typically work on new features directly against Chef Delivery's Git server.
* We've provided the source code in GitHub to make it easier to expereince the process of adding a feature to your cookbook and submitting it to the Chef Delivery pipeline.

## 1. Add a feature: add more sample rows to the database

- Add more sample rows.
- Also add the customer's location as latitude and longitude coordinates.

### Get the branch

```bash
# ~/Development/deliver-customers-rhel
$ git checkout -b add_sample_data origin/add_sample_data
Branch add_sample_data set up to track remote branch add_sample_data from origin.
Switched to a new branch 'add_sample_data'
$ git merge master
Auto-merging cookbooks/awesome_customers/metadata.rb
CONFLICT (content): Merge conflict in cookbooks/awesome_customers/metadata.rb
Automatic merge failed; fix conflicts and then commit the result.
```

```ruby
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers/metadata.rb
name 'awesome_customers'
maintainer 'The Authors'
maintainer_email 'you@example.com'
license 'all_rights'
description 'Installs/Configures awesome_customers'
long_description 'Installs/Configures awesome_customers'
<<<<<<< HEAD
version '1.1.0'
=======
version '1.0.0'
>>>>>>> master

depends 'httpd', '~> 0.2.18'
depends 'selinux', '~> 0.9.0'
depends 'iptables', '~> 1.0.0'
depends 'mysql2_chef_gem', '~> 1.0.1'
depends 'mysql', '~> 6.0.17'
depends 'database', '~> 4.0.3'
```

```ruby
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers/metadata.rb
name 'awesome_customers'
maintainer 'The Authors'
maintainer_email 'you@example.com'
license 'all_rights'
description 'Installs/Configures awesome_customers'
long_description 'Installs/Configures awesome_customers'
version '1.1.0'

depends 'httpd', '~> 0.2.18'
depends 'selinux', '~> 0.9.0'
depends 'iptables', '~> 1.0.0'
depends 'mysql2_chef_gem', '~> 1.0.1'
depends 'mysql', '~> 6.0.17'
depends 'database', '~> 4.0.3'
```

```bash
# ~/Development/deliver-customers-rhel
$ git add cookbooks/awesome_customers/metadata.rb
```

### Run lint, syntax, and unit tests

```bash
# ~/Development/deliver-customers-rhel
$ cd cookbooks/awesome_customers/
```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ foodcritic .

```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ rubocop .
Inspecting 16 files
................

16 files inspected, no offenses detected
```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ rspec --format documentation --color
[...]
Finished in 47.66 seconds (files took 8.35 seconds to load)
11 examples, 0 failures

```

### Run and verify it locally

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ kitchen list
Instance           Driver   Provisioner  Verifier  Transport  Last Action
default-centos-66  Vagrant  ChefZero     Busser    Ssh        <Not Created>
```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ kitchen converge
-----> Starting Kitchen (v1.4.2)
-----> Creating <default-centos-66>...
       Bringing machine 'default' up with 'virtualbox' provider...==> default: Box 'opscode-centos-6.6' could not be found. Attempting to find and install...
           default: Box Provider: virtualbox
           default: Box Version: >= 0
[...]
       Recipe: awesome_customers::webserver
         * httpd_service[customers] action restart

             - restart service service[customers delete httpd-customers]


       Running handlers:
       Running handlers complete

       Chef Client finished, 114/175 resources updated in 03 minutes 35 seconds
       Finished converging <default-centos-66> (4m5.04s).
-----> Kitchen is finished. (4m47.99s)
```

From a web browser, navigate to http://192.168.33.33/. You'll see this.

![](delivery/customers-sample-data.png)

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ kitchen verify
-----> Starting Kitchen (v1.4.2)
-----> Setting up <default-centos-66>...
       Finished setting up <default-centos-66> (0m0.00s).
-----> Verifying <default-centos-66>...
       Preparing files for transfer
-----> Installing Busser (busser)
[...]
       the customers web application
         is up and running

       the web_admin user
         has home directory /home/web_admin
         has login shell /bin/bash

       the default home page
         is owned by web_admin

       the httpd-customers service
         is enabled
         is running

       the default home page
         exists
         is a file
         has mode 644

       Finished in 0.20252 seconds (files took 0.27624 seconds to load)
       9 examples, 0 failures

       Finished verifying <default-centos-66> (5m19.45s).
-----> Kitchen is finished. (5m19.95s)
```

### Submit it to the pipeline

```bash
# ~/Development/deliver-customers-rhel/cookbooks
$ git status
On branch add_sample_data
Your branch is up-to-date with 'origin/add_sample_data'.
All conflicts fixed but you are still merging.
  (use "git commit" to conclude merge)

Changes to be committed:

	new file:   .delivery/build-cookbook/.kitchen.yml
	new file:   .delivery/build-cookbook/Berksfile
	new file:   .delivery/build-cookbook/LICENSE
	new file:   .delivery/build-cookbook/README.md
	new file:   .delivery/build-cookbook/attributes/default.rb
	new file:   .delivery/build-cookbook/chefignore
	new file:   .delivery/build-cookbook/data_bags/keys/delivery_builder_keys.json
	new file:   .delivery/build-cookbook/metadata.rb
	new file:   .delivery/build-cookbook/recipes/_aws_creds.rb
	new file:   .delivery/build-cookbook/recipes/default.rb
	new file:   .delivery/build-cookbook/recipes/deploy.rb
	new file:   .delivery/build-cookbook/recipes/functional.rb
	new file:   .delivery/build-cookbook/recipes/lint.rb
	new file:   .delivery/build-cookbook/recipes/provision.rb
	new file:   .delivery/build-cookbook/recipes/publish.rb
	new file:   .delivery/build-cookbook/recipes/quality.rb
	new file:   .delivery/build-cookbook/recipes/security.rb
	new file:   .delivery/build-cookbook/recipes/smoke.rb
	new file:   .delivery/build-cookbook/recipes/syntax.rb
	new file:   .delivery/build-cookbook/recipes/unit.rb
	new file:   .delivery/build-cookbook/secrets/fakey-mcfakerton
	new file:   .delivery/build-cookbook/spec/spec_helper.rb
	new file:   .delivery/build-cookbook/spec/unit/recipes/_aws_creds.rb_spec.rb
	new file:   .delivery/build-cookbook/spec/unit/recipes/_aws_creds_spec.rb
	new file:   .delivery/build-cookbook/test/fixtures/cookbooks/test/metadata.rb
	new file:   .delivery/build-cookbook/test/fixtures/cookbooks/test/recipes/default.rb
	new file:   .delivery/config.json

$ git commit -m "add sample data"
[add_sample_data 6236ee8] add sample data
$ delivery review
Chef Delivery
Loading configuration from /home/thomaspetchel/Development/deliver-customers-rhel
Review for change add_sample_data targeted for pipeline master
Created new patchset
https://10.194.11.99/e/test/#/organizations/learn-chef/projects/deliver-customers-rhel/changes/d1156bd3-c06f-4337-b0df-de6e187dff05
```

* Review the changes in the web interface. Click **Approve** when all tests pass.
* The process moves to the Build stage.
* The process moves to the Acceptance stage.
* After Acceptance succeeds, don't press the **Deliver** button. We'll queue up additional changes and deliver them as a single unit.

### Verify the change in the Acceptance environment

* Let's verify that version 1.1.0 of the `awesome_customers` cookbook successfully deployed to your Acceptance environment.
* Just like you did in the previous tutorial.

![](delivery/customers-sample-data-acceptance.png)

### Integrate the change

```bash
# ~/Development/deliver-customers-rhel
$ git checkout master
Switched to branch 'master'
Your branch is up-to-date with 'delivery/master'.
$ git fetch
remote: Counting objects: 1, done.
remote: Total 1 (delta 0), reused 0 (delta 0)
Unpacking objects: 100% (1/1), done.
From ssh://test@10.194.11.99:8989/test/learn-chef/deliver-customers-rhel
   e46f7b2..4fd27ce  master     -> delivery/master
$ git pull delivery master
From ssh://test@10.194.11.99:8989/test/learn-chef/deliver-customers-rhel
 * branch            master     -> FETCH_HEAD
Updating e46f7b2..4fd27ce
Fast-forward
 cookbooks/awesome_customers/attributes/default.rb  |  2 ++
 .../files/default/add-sample-data.sql              | 25 +++++++++++++++++
 .../files/default/create-tables.sql                |  7 ++---
 .../files/default/drop-tables.sql                  |  1 +
 cookbooks/awesome_customers/metadata.rb            |  2 +-
 cookbooks/awesome_customers/recipes/database.rb    | 32 +++++++++++++++++++++-
 .../spec/unit/recipes/database_spec.rb             |  2 ++
 7 files changed, 65 insertions(+), 6 deletions(-)
 create mode 100644 cookbooks/awesome_customers/files/default/add-sample-data.sql
 create mode 100644 cookbooks/awesome_customers/files/default/drop-tables.sql
```

[GITHUB] The final code for this section is available on [GitHub](https://github.com/learn-chef/deliver-customers-rhel/tree/add_sample_data-v1.0.0) (tag `add_sample_data-v1.0.0`.)

## 2. Add a feature: visualize customer data on an interactive control

- Instead of displaying customer data through an HTML table, this feature displays each sample customer's location on a [D3](http://d3js.org) control.
- The control is interactive. Users can use the mouse to spin the globe.

### Get the branch

```bash
# ~/Development/deliver-customers-rhel
$ git checkout -b visualize_data origin/visualize_data
Branch visualize_data set up to track remote branch visualize_data from origin.
Switched to a new branch 'visualize_data'
thomaspetchel@ubuntu:~/Development/deliver-customers-rhel$ git merge master
Merge made by the 'recursive' strategy.
 .delivery/build-cookbook/.kitchen.yml              |  21 +++
 .delivery/build-cookbook/Berksfile                 |  12 ++
 .delivery/build-cookbook/LICENSE                   |   3 +
[...]
```

### Run lint, syntax, and unit tests

```bash
# ~/Development/deliver-customers-rhel
$ cd cookbooks/awesome_customers/
```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ foodcritic .

```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ rubocop .
Inspecting 16 files
................

16 files inspected, no offenses detected
```

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ rspec --format documentation --color
[...]
Finished in 48.2 seconds (files took 3.87 seconds to load)
11 examples, 0 failures

```

### Run and verify it locally

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ kitchen converge
$ kitchen converge
-----> Starting Kitchen (v1.4.2)
-----> Converging <default-centos-66>...
       Preparing files for transfer
[...]
         * cookbook_file[/tmp/create-tables.sql] action create (up to date)
        (skipped due to not_if)
         * cookbook_file[/tmp/add-sample-data.sql] action create (up to date)
        (skipped due to not_if)

       Running handlers:
       Running handlers complete

       Chef Client finished, 4/173 resources updated in 07 seconds
       Finished converging <default-centos-66> (0m24.38s).
-----> Kitchen is finished. (0m24.91s)
```

From a web browser, navigate to http://192.168.33.33/. You'll see this.

![](delivery/customers-visualize-data-test-kitchen.png)

```bash
# ~/Development/deliver-customers-rhel/cookbooks/awesome_customers
$ kitchen verify
-----> Starting Kitchen (v1.4.2)
-----> Setting up <default-centos-66>...
       Finished setting up <default-centos-66> (0m0.00s).
-----> Verifying <default-centos-66>...
       Preparing files for transfer
-----> Installing Busser (busser)
[...]
       the customers web application
         is up and running

       the web_admin user
         has home directory /home/web_admin
         has login shell /bin/bash

       the default home page
         is owned by web_admin

       the httpd-customers service
         is enabled
         is running

       the default home page
         exists
         is a file
         has mode 644

       Finished in 0.18503 seconds (files took 0.2782 seconds to load)
       9 examples, 0 failures

       Finished verifying <default-centos-66> (0m17.66s).
-----> Kitchen is finished. (0m18.18s)
```

### Submit it to the pipeline

```bash
# ~/Development/deliver-customers-rhel/cookbooks
$ git status
On branch visualize_data
Your branch is ahead of 'origin/visualize_data' by 51 commits.
  (use "git push" to publish your local commits)
nothing to commit, working directory clean
$ delivery review
Chef Delivery
Loading configuration from /home/thomaspetchel/Development/deliver-customers-rhel
Review for change visualize_data targeted for pipeline master
Created new patchset
https://10.194.11.99/e/test/#/organizations/learn-chef/projects/deliver-customers-rhel/changes/9bf636e5-0dbd-47ff-84d4-cbf28f7762f1
```

* Review the changes in the web interface. Click **Approve** when all tests pass.
* The process moves to the Build stage.
* The process moves to the Acceptance stage.
* After Acceptance succeeds, press the **Deliver** button. This will move the integration of both features through the pipeline.

![](delivery/customers-visualize-data-delivered-pipeline.png)

### Verify the change in the Acceptance environment

* Let's verify that version 1.2.0 of the `awesome_customers` cookbook successfully deployed to your Delivered environment.
* Just like you did in the previous tutorial.

![](delivery/customers-visualize-data-delivered.png)

[GITHUB] The final code for this section is available on [GitHub](https://github.com/learn-chef/deliver-customers-rhel/tree/visualize_data_delivery-v1.0.0) (tag `visualize_data_delivery-v1.0.0`.)
