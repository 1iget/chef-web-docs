---
title: 'Make your recipe more manageable'
order: 4
layout: tutorial
description: Create a cookbook to make your recipes easier to manage
keywords: cookbook, recipe
---
[TIMETOCOMPLETE] 15

# Make your recipe more manageable

[Last time](/windows/configure-a-package-and-service/) you learned how to manage a package and a service by configuring a web server. You also added a basic web page. But there was one problem &ndash; although it helped you verify that your web server was properly configured, the code for your HTML page was embedded in the Chef recipe.

Let's create a _cookbook_ to make our web server recipe easier to manage. A cookbook provides structure to your recipes and enables you to more easily reference external files, such as our web server's home page. In essence, a cookbook helps you stay organized.

## <i class="fa fa-windows" style="margin-right:3px;"></i> Get a Windows Server machine

Like the previous tutorials, you'll configure the server directly. You can continue with the Windows Server machine you used in the previous tutorial, but let's review the options.

Option 1: use your own machine. If you have a Windows Server machine that you'd like to use, install the [Chef Development Kit](http://www.getchef.com/downloads/chef-dk/) on it now.

Option 2: let us provide an windows virtual machine that has the Chef tools installed for you. Just click the button below.

<div id="pre-launch">
<center>
<a id="launch-button" href="javascript:provisionHelper('ec2', 'windows', 'localmode', 'launch-button', 'launching', 'machine-details', 'launch-error')" class="button radius"><i class='fa fa-play'></i>&nbsp;Reserve a Windows Server virtual machine</a>
</center>
</div>

<div id="launching" style="display: none;">
<div class="spinner">
  <div class="cube1"></div>
  <div class="cube2"></div>
</div>
<center>We're provisioning a virtual machine for you. This'll take just a minute.</center>
</div>

<div id="machine-details" class="indent" style="display: none">
{0} Your virtual machine is all ready to go! Download the RDP shortcut file to connect.

<p/>
<center>
<a href="http://localhost:3000/labs/download_rdp?user_name={1}&ip_address={3}" class="button radius"><i class="fa fa-download"></i>&nbsp;Download Remote Desktop File</a>
</center>

Or connect using your remote desktop client.

<div>
</p>

[RDPINFO] {3}, {1}, {2}

</div>

<p/>

<p>
The environment expires <b>{4}</b>. If it expires, you're welcome to spin up a new one.

We hope you'll use the virtual machine to continue experimenting with Chef after you complete the tutorial. We only ask that you use the machine respectfully.
</p>
</div>

<div id="launch-error" class="alert-box error" style="display: none">

<i class="fa fa-exclamation-circle" style="color: #ff2222"></i> Something went wrong while provisioning your machine. We'll look into it. If you get the error again in a few minutes, either try the first option above or <a href="mailto:learnchef@getchef.com?subject=Feedback on Learn Chef">contact us</a>.

</div>

<sidebar style="line-height:1.7; font-size:1.0em; margin-top:30px; max-width:440px;">
<span style="line-height:2.0;"><i class="fa fa-search"></i>&nbsp;**As you read, think about:**</span><br>
  <i class="fa fa-check"></i>&nbsp; how cookbooks are organized.<br>
  <i class="fa fa-check"></i>&nbsp; why the run-list is important.<br>
</sidebar>

## <i class="fa fa-tasks rediconcolor" style="margin-right:3px;"></i> Here's what you'll do

  1. [Create a cookbook](#1createacookbook)
  1. [Create a template](#2createatemplate)
  1. [Update the recipe to reference the HTML template](#3updatetherecipetoreferencethehtmltemplate)
  1. [Run the cookbook](#4runthecookbook)

## 1. Create a cookbook

First, from your working directory, create a <filepath>cookbooks</filepath> directory and <codeinline>cd</codeinline> there.

```bash
# ~/chef-repo
$ mkdir cookbooks
$ cd cookbooks
```

[COMMENT] crushtime-6: ^ Folks mentioned as they worked through this that chef-[command] is picky about where you are in the dir structure. For example, must be in <filepath>cookbooks</filepath> to run the cookbook, but above cookbooks to create one. Follow the 'do what I mean' paradigm by automatically traversing the dir hierarchy up and down to place things where they need to go.

Now run the <codeinline>chef</codeinline> command to generate a cookbook named **webserver**.

```bash
# ~/chef-repo/cookbooks
$ chef generate cookbook webserver
```

Here's the directory structure that the command created.

```bash
# ~/chef-repo/cookbooks
$ tree /F
Folder PATH listing
Volume serial number is 5E71-6BA3
C:.
└───webserver
    │   .kitchen.yml
    │   Berksfile
    │   chefignore
    │   metadata.rb
    │   README.md
    │
    └───recipes
            default.rb
```

Note the default recipe, named <filepath>default.rb</filepath>. This is where we'll move our IIS recipe in a moment.

## 2. Create a template

Now we'll move the home page to our cookbook to an external file. First, run this command to generate the HTML file for our home page.

```bash
# ~/chef-repo/cookbooks
$ chef generate template webserver index.html
```

The file <filepath>index.html.erb</filepath> gets created under <filepath>webserver\templates\default</filepath>.

```bash
# ~\chef-repo\cookbooks
$ tree /F
Folder PATH listing
Volume serial number is 5E71-6BA3
C:.
└───webserver
    │   .kitchen.yml
    │   Berksfile
    │   chefignore
    │   metadata.rb
    │   README.md
    │
    ├───recipes
    │       default.rb
    │
    └───templates
        └───default
                index.html.erb
```

The .erb extension simply means that the file can have placeholders. More on that later.

Now copy the contents of the HTML file from your recipe to the new HTML file, <filepath>index.html.erb</filepath>.

```html
<!-- ~\chef-repo\cookbooks\webserver\templates\default\index.html.erb -->
<html>
  <body>
    <h1>hello world</h1>
  </body>
</html>
```

## 3. Update the recipe to reference the HTML template

Write out the recipe, <filepath>default.rb</filepath>, like this.

```ruby
# ~\chef-repo\cookbooks\webserver\recipes\default.rb
powershell_script 'Install IIS' do
  code 'add-windowsfeature Web-Server'
end

service 'w3svc' do
  action [:start, :enable]
end

template 'c:\inetpub\wwwroot\Default.htm' do
  source 'index.html.erb'
end
```

## 4. Run the cookbook

Now run the cookbook. To do so, we use the <codeinline>chef-client</codeinline> command and specify what's called the _run-list_.

```bash
# ~\chef-repo
$ chef-client --local-mode --runlist webserver
[2014-08-13T21:48:03+00:00] WARN: No config file found or specified on command line, using command line options.
Starting Chef Client, version 11.14.0.rc.2
resolving cookbooks for run list: ["webserver"]
Synchronizing Cookbooks:
  - webserver
Compiling Cookbooks...
Converging 3 resources
Recipe: webserver::default
  * powershell_script[Install IIS] action run
    - execute "powershell.exe" -NoLogo -NonInteractive -NoProfile -ExecutionPolicy RemoteSigned -InputFormat None -File
"C:/Users/chef/AppData/Local/Temp/chef-script20140813-2360-tltb25.ps1"
  * service[w3svc] action start (up to date)
  * service[w3svc] action enable (up to date)
  * template[c:\inetpub\wwwroot\Default.htm] action create
    - update content in file c:\inetpub\wwwroot\Default.htm from 2914aa to 100c2f
    (no diff)

Running handlers:
Running handlers complete
Chef Client finished, 2/4 resources updated in 38.188832 seconds
```

[CONCEPT] You ran <codeinline>chef-apply</codeinline> to run a single recipe from the command line. <codeinline>chef-client</codeinline> is what you use to run a cookbook.

Run <codeinline>Invoke-WebRequest</codeinline> or refresh your web browser to confirm that your web page is still available.

```bash
# ~\chef-repo
$ (Invoke-WebRequest localhost).Content
<html>
  <body>
    <h1>hello world</h1>
  </body>
</html>
```

The result is the same as before, but with a cookbook things are now easier to manage.

## <i class="fa fa-question blueiconcolor" style="margin-right:3px;"></i> What did we see here?

Your web server is shaping up! With a [cookbook][cookbook] you're now better organized. A cookbook adds structure to your work. You can now author your HTML code in its own file and use  a [template][template] resource to reference it from your recipe.

You also saw the [run-list][run-list]. The run-list lets you specify which recipes to run, and the order in which to run them. This is handy once you have lots of cookbooks, and the order in which they run is important.

## <i class="fa fa-road blueiconcolor" style="margin-right:3px;"></i> What's next

Next you'll get ready to configure a second web server by uploading your cookbook to a Chef server.

<%= link_to 'Get ready to add another server &rarr;', '/windows/get-ready-to-add-another-server/', class: 'button radius' %>

<script src='../../../assets/javascripts/provision.js' type='text/javascript'></script>


[cookbook]: http://docs.opscode.com/essentials_cookbooks.html
[template]: http://docs.opscode.com/resource_template.html
[run-list]: http://docs.opscode.com/essentials_node_object_run_lists.html
